import"./common.min.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const i of e.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function n(t){if(t.ep)return;t.ep=!0;const e=o(t);fetch(t.href,e)}})();const p=7,y=7,O="assets/img/icon/",I=["pic_01.png","pic_02.png","pic_03.png","pic_04.png","pic_05.png","pic_06.png","pic_07.png"],M=100,L=.07,D=450,W=1e3,_=document.querySelector(".drum"),A=_.querySelector(".drum-layer--old .drum-columns"),h=_.querySelector(".drum-layer--new .drum-columns"),T=document.querySelector(".menu__button-spin");let w=!1,N=0,g=[];function P(){return I[Math.floor(Math.random()*I.length)]}function Y(){T.classList.add("disabled")}function q(){T.classList.remove("disabled")}function b(){const s=[];for(let r=0;r<y;r++){const o=[];for(let n=0;n<p;n++)o.push(P());s.push(o)}return s}function G(){let s;do s=b();while(v(s).length>0);return s}function H(){let s;do s=b();while(v(s).length===0);return s}function C(s,r,o=!1){s.innerHTML="",r.forEach((n,t)=>{const e=document.createElement("div");e.className="drum-column",o&&(e.classList.add("drop-in"),e.style.animationDelay=`${t*L}s`),n.forEach(i=>{const l=document.createElement("div");l.className="drum__item";const f=document.createElement("div");f.className="drum__item-inner";const m=document.createElement("img");m.src=O+i,m.alt="Icon game",f.appendChild(m),l.appendChild(f),e.appendChild(l)}),s.appendChild(e)})}function v(s){const r=Array.from({length:y},()=>Array(p).fill(!1)),o=[];function n(t,e,i,l){t<0||t>=y||e<0||e>=p||r[t][e]||s[t][e]!==i||(r[t][e]=!0,l.push({c:t,r:e}),n(t+1,e,i,l),n(t-1,e,i,l),n(t,e+1,i,l),n(t,e-1,i,l))}for(let t=0;t<y;t++)for(let e=0;e<p;e++)if(!r[t][e]){const i=[];n(t,e,s[t][e],i),i.length>=3&&o.push(i)}return o}function x(s){h.querySelectorAll(".drum__item.win").forEach(r=>r.classList.remove("win")),s.forEach(r=>{r.forEach(({c:o,r:n})=>{const t=h.children[o];if(!t)return;const e=t.children[n];e&&e.classList.add("win")})})}function $(){h.querySelectorAll(".drum-column").forEach((r,o)=>{const n=r.querySelectorAll(".drum__item");if(!n.length)return;const t=M+o*L*1e3;setTimeout(()=>{const e=n.length;n.forEach((i,l)=>{const f=(l+1)/e,m=.1*f,E=3.2*Math.pow(f,2);i.style.setProperty("--land-scale",m.toFixed(3)),i.style.setProperty("--land-shift",`${E.toFixed(2)}%`),i.classList.remove("land"),i.offsetWidth,i.classList.add("land")})},t)})}function B(s){s.forEach(r=>{r.forEach(({c:o,r:n})=>{const t=h.children[o];if(!t)return;const e=t.children[n];e&&e.classList.add("disappear")})})}function F(s,r){const o=s.map(n=>[...n]);r.forEach(n=>{n.forEach(({c:t,r:e})=>{o[t][e]=null})});for(let n=0;n<y;n++){const t=o[n].filter(l=>l!==null),e=p-t.length,i=Array.from({length:e},P);o[n]=[...i,...t]}return o}function z(s,r){const o=h.querySelectorAll(".drum-column");o.forEach((n,t)=>{const e=s[t],i=r[t],l=e.filter(c=>c===null).length;if(l===0)return;[...n.children],n.innerHTML="";const f=[];i.forEach((c,a)=>{const u=document.createElement("div");u.className="drum__item";const d=document.createElement("div");d.className="drum__item-inner";const S=document.createElement("img");S.src=O+c,S.alt="Icon game",d.appendChild(S),u.appendChild(d),u.style.transition="none",f.push(u),n.appendChild(u)});const m=[];let E=0;for(let c=0;c<p;c++)if(c<l)m[c]=null;else{let a=0,u=0;for(let d=0;d<p;d++)if(e[d]!==null){if(u===E){a=d;break}u++}m[c]=a,E++}for(let c=0;c<p;c++){const a=f[c],u=m[c];if(u===null){const d=(p+l-c)*100;a.style.transform=`translateY(-${d}%)`,a.dataset.isNew="true",a.dataset.needsAnimation="true"}else{const d=c-u;d===0?(a.style.transform="translateY(0)",a.dataset.needsAnimation="false"):d>0?(a.style.transform=`translateY(-${d*100}%)`,a.dataset.needsAnimation="true"):(a.style.transform="translateY(0)",a.dataset.needsAnimation="false"),a.dataset.isNew="false"}}}),o.forEach(n=>{n.offsetHeight}),setTimeout(()=>{o.forEach(n=>{n.querySelectorAll(".drum__item").forEach(e=>{e.dataset.needsAnimation!=="false"&&(e.style.transition="transform 0.6s cubic-bezier(.22,.61,.36,1)",e.style.transform="translateY(0)")})})},50)}function R(){const s=v(g);if(s.length===0){w=!1,q();return}x(s),setTimeout(()=>{B(s),setTimeout(()=>{const r=g.map(n=>[...n]);s.forEach(n=>{n.forEach(({c:t,r:e})=>{r[t][e]=null})});const o=F(g,s);_.classList.add("cascading"),z(r,o),g=o,setTimeout(()=>{_.classList.remove("cascading"),C(h,g),R()},600)},D)},W)}g=G(),C(h,g);function K(){if(w)return;w=!0,Y(),C(A,g),h.innerHTML="",A.querySelectorAll(".drum-column").forEach((r,o)=>{r.classList.add("drop-out"),r.style.animationDelay=`${o*L}s`}),setTimeout(()=>{A.innerHTML="",N++;const r=N===2;let o;r?o=H():o=G(),C(h,o,!0),g=o,setTimeout(()=>{$()},300),r?setTimeout(()=>{R()},600):(w=!1,setTimeout(()=>{q()},900))},M+y*L*1e3)}T.addEventListener("click",s=>{s.preventDefault(),K()});
